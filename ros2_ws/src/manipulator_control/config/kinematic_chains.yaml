# config/kinematic_chains.yaml
# Joint group definitions for MoveJointGroup action server (Story 2.5)
#
# DO NOT add joint limits here - ControllerInterface loads from manipulator_params.yaml
#
# Groups support two modes:
#   - Named group: goal.joint_group = "navigation" (uses joints defined here)
#   - Explicit joints: goal.joint_names = ["joint1", "joint2"]
#
# Container group uses mimic_mode: accept single "opening" value,
# calculate left = -opening/2, right = +opening/2

joint_groups:
  navigation:
    joints:
      - base_main_frame_joint
      - main_frame_selector_frame_joint
    description: "X-Z positioning for address navigation"
    default_velocity: 0.5
    default_acceleration: 0.25  # m/s^2 - smooth acceleration for navigation

    # End effector configuration for NavigateToAddress (Story 3.4)
    # TF frame to align with target address coordinates
    end_effector_frame: "selector_frame"
    # Optional offset from frame origin [x, y, z] in meters
    # Note: This is subtracted from world coordinates to adjust for end effector position
    end_effector_offset: [0.0, 0.0, 0.0]

    # World-to-joint coordinate mapping (DYNAMIC - no hardcoded offsets!)
    # For each joint: which world axis it controls
    #
    # The navigate_to_address_server uses TF to dynamically calculate joint targets:
    #   1. Get current end effector world position from TF (world -> selector_frame)
    #   2. Get current joint positions from /joint_states
    #   3. Calculate: delta = target_world - current_world
    #   4. Calculate: new_joint = current_joint + delta
    #
    # This works regardless of robot base position - no recalibration needed!
    coordinate_mapping:
      base_main_frame_joint:
        axis: "x"       # This joint controls world X position
      main_frame_selector_frame_joint:
        axis: "z"       # This joint controls world Z position

  gripper:
    joints:
      - selector_frame_gripper_joint
      - main_frame_selector_frame_joint
    description: "Gripper Y-axis with Z adjustment (generic)"
    default_velocity: 0.3
    default_acceleration: 0.15  # m/s^2
    # End effector frames for trajectory visualization (Story 4A-1a)
    # Use side-specific frame: left -> left_gripper_magnet, right -> right_gripper_magnet
    end_effector_frames:
      left: "left_gripper_magnet"
      right: "right_gripper_magnet"
    # Magnet offset from gripper joint (selector_frame) in Y direction
    # The magnet tip is this distance ahead of the joint origin
    # Used to convert end effector positions to joint positions:
    #   joint_y = end_effector_y - magnet_offset (for left side)
    magnet_offset: 0.040  # meters (40mm)
    # Coordinate mapping for trajectory execution
    coordinate_mapping:
      selector_frame_gripper_joint:
        axis: "y"       # Into/out of cabinet
      main_frame_selector_frame_joint:
        axis: "z"       # Vertical position

  # Left and right gripper magnet groups for box extraction/insertion
  # These define the magnets as end effectors for YZ trajectory execution
  left_gripper:
    joints:
      - selector_frame_gripper_joint
      - main_frame_selector_frame_joint
    description: "Left magnet end effector for left-side cabinets"
    default_velocity: 0.3
    default_acceleration: 0.15
    end_effector_frame: "left_gripper_magnet"
    # Coordinate mapping for trajectory execution
    # Y-axis: gripper moves into cabinet (positive Y for left side)
    # Z-axis: vertical position
    coordinate_mapping:
      selector_frame_gripper_joint:
        axis: "y"
      main_frame_selector_frame_joint:
        axis: "z"

  right_gripper:
    joints:
      - selector_frame_gripper_joint
      - main_frame_selector_frame_joint
    description: "Right magnet end effector for right-side cabinets"
    default_velocity: 0.3
    default_acceleration: 0.15
    end_effector_frame: "right_gripper_magnet"
    # Coordinate mapping for trajectory execution
    # Y-axis: gripper moves into cabinet (negative Y for right side)
    # Z-axis: vertical position
    coordinate_mapping:
      selector_frame_gripper_joint:
        axis: "y"
      main_frame_selector_frame_joint:
        axis: "z"

  picker:
    joints:
      - selector_frame_picker_frame_joint
      - picker_frame_picker_rail_joint
      - picker_rail_picker_base_joint
      - picker_base_picker_jaw_joint
    description: "All picker joints for item picking"
    default_velocity: 0.2
    default_acceleration: 0.1  # m/s^2 - gentle for precision picking

  container:
    joints:
      - selector_left_container_jaw_joint
      - selector_right_container_jaw_joint
    description: "Container jaws (synchronized mimic)"
    default_velocity: 0.1
    default_acceleration: 0.05  # m/s^2 - slow for container handling
    mimic_mode: true  # Single opening value -> symmetric positions (left=-val/2, right=+val/2)
